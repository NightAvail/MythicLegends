#######################################################
# Mythic Legends
# Events
#
# Author:  NightAvail
#######################################################

namespace = ml_events_spells
namespace = ml_events_common

# Become immortal
character_event = {
    id = "ml_events_spells.11"
    desc = "ml_events_spells.11desc"
    picture = GFX_evt_garden

    is_triggered_only = yes

    trigger = {
        trait = ml_trait_magical_blood

        NOT = { trait = ml_trait_immortal }
    }

    option = {
        name = "ml_events_spells.11a"

        add_trait = ml_trait_immortal
    }
}

# Activate the buff spell
character_event = {
    id = "ml_events_spells.1"

    hide_window = yes

    is_triggered_only = yes

    # We should have magical blood!
    trigger = {
        trait = ml_trait_magical_blood
    }

    # Activate the spell based on arcane level.
    immediate = {
        # Beginner
        if = {
            limit = { trait = ml_trait_arcane_spell_beginner }
            add_character_modifier = {
                name = "ml_event_modifiers_spells_buff_1"
                days = -1
            }

            add_trait = ml_trait_buff_spell_1
            remove_trait = ml_trait_buff_spell_2
            remove_trait = ml_trait_buff_spell_3
            remove_trait = ml_trait_buff_spell_4
        }

        # Apprentice
        if = {
            limit = { trait = ml_trait_arcane_spell_apprentice }
            add_character_modifier = {
                name = "ml_event_modifiers_spells_buff_2"
                days = -1
            }

            remove_trait = ml_trait_buff_spell_1
            add_trait = ml_trait_buff_spell_2
            remove_trait = ml_trait_buff_spell_3
            remove_trait = ml_trait_buff_spell_4
        }

        # Expert
        if = {
            limit = { trait = ml_trait_arcane_spell_expert }
            add_character_modifier = {
                name = "ml_event_modifiers_spells_buff_3"
                days = -1
            }

            remove_trait = ml_trait_buff_spell_1
            remove_trait = ml_trait_buff_spell_2
            add_trait = ml_trait_buff_spell_3
            remove_trait = ml_trait_buff_spell_4
        }

        # Master
        if = {
            limit = { trait = ml_trait_arcane_spell_master }
            add_character_modifier = {
                name = "ml_event_modifiers_spells_buff_4"
                days = -1
            }

            remove_trait = ml_trait_buff_spell_1
            remove_trait = ml_trait_buff_spell_2
            remove_trait = ml_trait_buff_spell_3
            add_trait = ml_trait_buff_spell_4
        }

        set_character_flag = ml_flag_active_buff_spell
    }

    # Default option
    option = {
        name = ml_events_common.ok
    }
}

# Activate the healing spell
character_event = {
    id = "ml_events_spells.2"
    desc = "ml_events_spells.2desc"
    picture = GFX_evt_recovery
    #hide_window = yes

    is_triggered_only = yes

    # We should have magical blood!
    trigger = {
        trait = ml_trait_magical_blood
    }

    # Activate the spell based on arcane level.
    option = {
        set_character_flag = ml_flag_recent_healing_spell

        clr_character_flag = developing_illness
        clr_character_flag = 3_year_physician_cooldown
        clr_character_flag = recent_treatment
        clr_character_flag = manifest_cancer
        clr_character_flag = being_treated

        clr_character_flag = got_typhoid_fever
        clr_character_flag = got_cancer
        clr_character_flag = got_bubonic_plague
        clr_character_flag = got_aztec_disease
        clr_character_flag = got_smallpox
        clr_character_flag = got_measles
        clr_character_flag = got_typhus
        clr_character_flag = got_syphilis
        clr_character_flag = got_pneumonia
        clr_character_flag = got_rabies
        clr_character_flag = got_gout
        clr_character_flag = got_flu
        clr_character_flag = got_dysentery
        clr_character_flag = got_food_poisoning

        name = ml_events_common.feelgreat

        # Spell cooldown
        character_event = {
            id = "ml_events_spells.3"
            days = 365
        }

        # Beginner
        if = {
            limit = { trait = ml_trait_arcane_spell_beginner }

            # Remove Sickness
            if = {
                limit = { trait = ill }
                remove_trait = ill
            }

            # Heal Body
            if = {
                limit = { trait = wounded }
                remove_trait = wounded
            }
        }

        # Apprentice
        if = {
            limit = { trait = ml_trait_arcane_spell_apprentice }

            # Remove Sickness
            if = {
                limit = { trait = ill }
                remove_trait = ill
            }
            if = {
                limit = { trait = pneumonic }
                remove_trait = pneumonic
            }
            if = {
                limit = { trait = syphilitic }
                remove_trait = syphilitic
            }
            if = {
                limit = { trait = has_tuberculosis }
                remove_trait = has_tuberculosis
            }
            if = {
                limit = { trait = has_typhoid_fever }
                remove_trait = has_typhoid_fever
            }
            if = {
                limit = { trait = has_typhus }
                remove_trait = has_typhus
            }
            if = {
                limit = { trait = has_bubonic_plague }
                remove_trait = has_bubonic_plague
            }
            if = {
                limit = { trait = has_measles }
                remove_trait = has_measles
            }
            if = {
                limit = { trait = has_small_pox }
                remove_trait = has_small_pox
            }
            if = {
                limit = { trait = has_aztec_disease }
                remove_trait = has_aztec_disease
            }
            if = {
                limit = { trait = leper }
                remove_trait = leper
            }
            if = {
                limit = { trait = eunuch }
                remove_trait = eunuch
            }

            # Reaper's Due DLC Symptoms            
            if = {
                limit = { trait = cough }
                remove_trait = cough
            }            
            if = {
                limit = { trait = fever }
                remove_trait = fever
            }            
            if = {
                limit = { trait = diarrhea }
                remove_trait = diarrhea
            }            
            if = {
                limit = { trait = vomiting }
                remove_trait = vomiting
            }            
            if = {
                limit = { trait = chest_pain }
                remove_trait = chest_pain
            }            
            if = {
                limit = { trait = cramps }
                remove_trait = cramps
            }            
            if = {
                limit = { trait = rash }
                remove_trait = rash
            }            
            if = {
                limit = { trait = headache }
                remove_trait = headache
            }            
            if = {
                limit = { trait = abdominal_pain }
                remove_trait = abdominal_pain
            }            
            if = {
                limit = { trait = fatigue }
                remove_trait = fatigue
            }            
            if = {
                limit = { trait = malaise }
                remove_trait = malaise
            }            
            if = {
                limit = { trait = infection }
                remove_trait = infection
            }            
            if = {
                limit = { trait = flu }
                remove_trait = flu
            }            
            if = {
                limit = { trait = dysentery }
                remove_trait = dysentery
            }            
            if = {
                limit = { trait = gout }
                remove_trait = gout
            }            
            if = {
                limit = { trait = food_poisoning }
                remove_trait = food_poisoning
            }            
            if = {
                limit = { trait = rabies }
                remove_trait = rabies
            }            
            if = {
                limit = { trait = cancer }
                remove_trait = cancer
            }            
            if = {
                limit = { trait = scurvy }
                remove_trait = scurvy
            }            
            if = {
                limit = { trait = sick_incapable }
                remove_trait = sick_incapable
            }
            
            # Heal Body
            if = {
                limit = { trait = wounded }
                remove_trait = wounded
            }
        }

        # Expert
        if = {
            limit = { trait = ml_trait_arcane_spell_expert }

            # Remove Sickness
            if = {
                limit = { trait = ill }
                remove_trait = ill
            }
            if = {
                limit = { trait = pneumonic }
                remove_trait = pneumonic
            }
            if = {
                limit = { trait = syphilitic }
                remove_trait = syphilitic
            }
            if = {
                limit = { trait = has_tuberculosis }
                remove_trait = has_tuberculosis
            }
            if = {
                limit = { trait = has_typhoid_fever }
                remove_trait = has_typhoid_fever
            }
            if = {
                limit = { trait = has_typhus }
                remove_trait = has_typhus
            }
            if = {
                limit = { trait = has_bubonic_plague }
                remove_trait = has_bubonic_plague
            }
            if = {
                limit = { trait = has_measles }
                remove_trait = has_measles
            }
            if = {
                limit = { trait = has_small_pox }
                remove_trait = has_small_pox
            }
            if = {
                limit = { trait = has_aztec_disease }
                remove_trait = has_aztec_disease
            }
            if = {
                limit = { trait = leper }
                remove_trait = leper
            }

            # Heal Body
            if = {
                limit = { trait = wounded }
                remove_trait = wounded
            }
            if = {
                limit = { trait = infirm }
                remove_trait = infirm
            }
            if = {
                limit = { trait = blinded }
                remove_trait = blinded
            }
            if = {
                limit = { trait = eunuch }
                remove_trait = eunuch
            }
            if = {
                limit = { trait = incapable }
                remove_trait = incapable
            }
            if = {
                limit = { trait = crippled }
                remove_trait = crippled
            }
            if = {
                limit = { trait = lunatic }
                remove_trait = lunatic
            }
            if = {
                limit = { trait = stressed }
                remove_trait = stressed
            }
            if = {
                limit = { trait = depressed }
                remove_trait = depressed
            }
            if = {
                limit = { trait = possessed }
                remove_trait = possessed
            }
            if = {
                limit = { trait = has_bloody_flux }
                remove_trait = has_bloody_flux
            }
            if = {
                limit = { trait = has_grey_plague }
                remove_trait = has_grey_plague
            }
            if = {
                limit = { trait = has_greyscale }
                remove_trait = has_greyscale
            }
            if = {
                limit = { trait = inbred }
                remove_trait = inbred
            }
            if = {
                limit = { trait = blinded_age }
                remove_trait = blinded_age
            }

            # Reaper's Due DLC Symptoms            
            if = {
                limit = { trait = cough }
                remove_trait = cough
            }            
            if = {
                limit = { trait = fever }
                remove_trait = fever
            }            
            if = {
                limit = { trait = diarrhea }
                remove_trait = diarrhea
            }            
            if = {
                limit = { trait = vomiting }
                remove_trait = vomiting
            }            
            if = {
                limit = { trait = chest_pain }
                remove_trait = chest_pain
            }            
            if = {
                limit = { trait = cramps }
                remove_trait = cramps
            }            
            if = {
                limit = { trait = rash }
                remove_trait = rash
            }            
            if = {
                limit = { trait = headache }
                remove_trait = headache
            }            
            if = {
                limit = { trait = abdominal_pain }
                remove_trait = abdominal_pain
            }            
            if = {
                limit = { trait = fatigue }
                remove_trait = fatigue
            }            
            if = {
                limit = { trait = malaise }
                remove_trait = malaise
            }            
            if = {
                limit = { trait = infection }
                remove_trait = infection
            }            
            if = {
                limit = { trait = flu }
                remove_trait = flu
            }            
            if = {
                limit = { trait = dysentery }
                remove_trait = dysentery
            }            
            if = {
                limit = { trait = gout }
                remove_trait = gout
            }            
            if = {
                limit = { trait = food_poisoning }
                remove_trait = food_poisoning
            }            
            if = {
                limit = { trait = rabies }
                remove_trait = rabies
            }            
            if = {
                limit = { trait = cancer }
                remove_trait = cancer
            }            
            if = {
                limit = { trait = scurvy }
                remove_trait = scurvy
            }            
            if = {
                limit = { trait = sick_incapable }
                remove_trait = sick_incapable
            }
        }

        # Master
        if = {
            limit = { trait = ml_trait_arcane_spell_master }

            # Remove Sickness
            if = {
                limit = { trait = ill }
                remove_trait = ill
            }
            if = {
                limit = { trait = pneumonic }
                remove_trait = pneumonic
            }
            if = {
                limit = { trait = syphilitic }
                remove_trait = syphilitic
            }
            if = {
                limit = { trait = has_tuberculosis }
                remove_trait = has_tuberculosis
            }
            if = {
                limit = { trait = has_typhoid_fever }
                remove_trait = has_typhoid_fever
            }
            if = {
                limit = { trait = has_typhus }
                remove_trait = has_typhus
            }
            if = {
                limit = { trait = has_bubonic_plague }
                remove_trait = has_bubonic_plague
            }
            if = {
                limit = { trait = has_measles }
                remove_trait = has_measles
            }
            if = {
                limit = { trait = has_small_pox }
                remove_trait = has_small_pox
            }
            if = {
                limit = { trait = has_aztec_disease }
                remove_trait = has_aztec_disease
            }
            if = {
                limit = { trait = leper }
                remove_trait = leper
            }

            # Heal Body
            if = {
                limit = { trait = wounded }
                remove_trait = wounded
            }
            if = {
                limit = { trait = infirm }
                remove_trait = infirm
            }
            if = {
                limit = { trait = blinded }
                remove_trait = blinded
            }
            if = {
                limit = { trait = eunuch }
                remove_trait = eunuch
            }
            if = {
                limit = { trait = incapable }
                remove_trait = incapable
            }
            if = {
                limit = { trait = crippled }
                remove_trait = crippled
            }
            if = {
                limit = { trait = lunatic }
                remove_trait = lunatic
            }
            if = {
                limit = { trait = stressed }
                remove_trait = stressed
            }
            if = {
                limit = { trait = depressed }
                remove_trait = depressed
            }
            if = {
                limit = { trait = possessed }
                remove_trait = possessed
            }
            if = {
                limit = { trait = has_bloody_flux }
                remove_trait = has_bloody_flux
            }
            if = {
                limit = { trait = has_grey_plague }
                remove_trait = has_grey_plague
            }
            if = {
                limit = { trait = has_greyscale }
                remove_trait = has_greyscale
            }
            if = {
                limit = { trait = inbred }
                remove_trait = inbred
            }
            if = {
                limit = { trait = blinded_age }
                remove_trait = blinded_age
            }

            # Regenerate Body
            if = {
                limit = { trait = maimed }
                remove_trait = maimed
            }
            if = {
                limit = { trait = harelip }
                remove_trait = harelip
            }
            if = {
                limit = { trait = hunchback }
                remove_trait = hunchback
            }
            if = {
                limit = { trait = lisp }
                remove_trait = lisp
            }
            if = {
                limit = { trait = stutter }
                remove_trait = stutter
            }
            if = {
                limit = { trait = ugly }
                remove_trait = ugly
            }
            if = {
                limit = { trait = dwarf }
                remove_trait = dwarf
            }
            if = {
                limit = { trait = scarred }
                remove_trait = scarred
            }

            # Reaper's Due DLC Symptoms            
            if = {
                limit = { trait = cough }
                remove_trait = cough
            }            
            if = {
                limit = { trait = fever }
                remove_trait = fever
            }            
            if = {
                limit = { trait = diarrhea }
                remove_trait = diarrhea
            }            
            if = {
                limit = { trait = vomiting }
                remove_trait = vomiting
            }            
            if = {
                limit = { trait = chest_pain }
                remove_trait = chest_pain
            }            
            if = {
                limit = { trait = cramps }
                remove_trait = cramps
            }            
            if = {
                limit = { trait = rash }
                remove_trait = rash
            }            
            if = {
                limit = { trait = headache }
                remove_trait = headache
            }            
            if = {
                limit = { trait = abdominal_pain }
                remove_trait = abdominal_pain
            }            
            if = {
                limit = { trait = fatigue }
                remove_trait = fatigue
            }            
            if = {
                limit = { trait = malaise }
                remove_trait = malaise
            }            
            if = {
                limit = { trait = infection }
                remove_trait = infection
            }            
            if = {
                limit = { trait = flu }
                remove_trait = flu
            }            
            if = {
                limit = { trait = dysentery }
                remove_trait = dysentery
            }            
            if = {
                limit = { trait = gout }
                remove_trait = gout
            }            
            if = {
                limit = { trait = food_poisoning }
                remove_trait = food_poisoning
            }            
            if = {
                limit = { trait = rabies }
                remove_trait = rabies
            }            
            if = {
                limit = { trait = cancer }
                remove_trait = cancer
            }            
            if = {
                limit = { trait = scurvy }
                remove_trait = scurvy
            }            
            if = {
                limit = { trait = sick_incapable }
                remove_trait = sick_incapable
            }
            
            # Reaper's Due DLC
            if = {
                limit = { trait = one_eyed }
                remove_trait = one_eyed
            }
            if = {
                limit = { trait = one_handed }
                remove_trait = one_handed
            }
            if = {
                limit = { trait = one_legged }
                remove_trait = one_legged
            }
            if = {
                limit = { trait = disfigured }
                remove_trait = disfigured
            }
            if = {
                limit = { trait = mangled }
                remove_trait = mangled
            }
            if = {
                limit = { trait = severely_injured }
                remove_trait = severely_injured
            }
        }
    }

    # Cancle operation
    option = {
        name = ml_events_common.nevermind
    }

    # Default option
    # option = {
    #     name = ml_events_common.ok
    #
    #     # Spell cooldown
    #     character_event = {
    #         id = "ml_events_spells.3"
    #         days = 365
    #     }
    # }
}

# Clear healing cooldown
character_event = {
    id = "ml_events_spells.3"

    hide_window = yes

    is_triggered_only = yes

    trigger = {
        has_character_flag = ml_flag_recent_healing_spell
    }

    # Default option
    option = {
        clr_character_flag = ml_flag_recent_healing_spell
        name = ml_events_common.ok
    }
}

# Player activates plague spell.
character_event = {
    id = "ml_events_spells.4"

    hide_window = yes

    is_triggered_only = yes

    # We should have magical blood!
    trigger = {
        trait = ml_trait_magical_blood
    }

    immediate = {
        set_character_flag = ml_flag_active_plague_spell
    }

    # Default option
    option = {
        name = ml_events_common.ok
    }
}

# Clear plague spell cooldown
character_event = {
    id = "ml_events_spells.5"

    hide_window = yes

    is_triggered_only = yes

    trigger = {
        has_character_flag = ml_flag_recent_plague_spell
    }

    immediate = {
        clr_character_flag = ml_flag_recent_plague_spell
    }

    # Default option
    option = {
        name = ml_events_common.ok
    }
}

# Activate the prosper spell
character_event = {
    id = "ml_events_spells.6"

    hide_window = yes

    is_triggered_only = yes

    # We should have magical blood!
    trigger = {
        trait = ml_trait_magical_blood
    }

    # Activate the spell based on arcane level.
    immediate = {
        # Beginner
        if = {
            limit = { trait = ml_trait_arcane_spell_beginner }
            add_character_modifier = {
                name = "ml_event_modifiers_spells_prosper_1"
                days = -1
            }
        }

        # Apprentice
        if = {
            limit = { trait = ml_trait_arcane_spell_apprentice }
            add_character_modifier = {
                name = "ml_event_modifiers_spells_prosper_2"
                days = -1
            }
        }

        # Expert
        if = {
            limit = { trait = ml_trait_arcane_spell_expert }
            add_character_modifier = {
                name = "ml_event_modifiers_spells_prosper_3"
                days = -1
            }
        }

        # Master
        if = {
            limit = { trait = ml_trait_arcane_spell_master }
            add_character_modifier = {
                name = "ml_event_modifiers_spells_prosper_4"
                days = -1
            }
        }

        set_character_flag = ml_flag_active_prosper_spell
    }

    # Default option
    option = {
        name = ml_events_common.ok
    }
}

# Player activates life change spell.
character_event = {
    id = "ml_events_spells.7"

    hide_window = yes

    is_triggered_only = yes

    # We should have magical blood!
    trigger = {
        trait = ml_trait_magical_blood
    }

    immediate = {
        set_character_flag = ml_flag_active_lifechange_spell
    }

    # Default option
    option = {
        name = ml_events_common.ok
    }
}

# Clear life change spell cooldown
character_event = {
    id = "ml_events_spells.8"

    hide_window = yes

    is_triggered_only = yes

    trigger = {
        has_character_flag = ml_flag_recent_lifechange_spell
    }

    immediate = {
        clr_character_flag = ml_flag_recent_lifechange_spell
    }

    # Default option
    option = {
        name = ml_events_common.ok
    }
}

# Player casts summoning spell.
character_event = {
    id = "ml_events_spells.9"

    hide_window = yes

    is_triggered_only = yes

    # We should have magical blood!
    trigger = {
        trait = ml_trait_magical_blood
    }

    immediate = {
        # Beginner
        if = {
            limit = { trait = ml_trait_arcane_spell_beginner }

            # Earth mages will summon extra golem troops!
            if = {
                limit = { has_character_flag = ml_flag_earth_mage }
                spawn_unit = {
                    owner = ROOT
                    province = ROOT
                    home = ROOT
                    troops = {
                        light_infantry = { 500 500 }
                        heavy_infantry = { 500 500 }
                    }
                    attrition = 1.0
                    disband_on_peace = yes
                    maintenance_multiplier = 0
                }
            }

            if = {
                limit = { NOT = { has_character_flag = ml_flag_earth_mage } }
                spawn_unit = {
                    owner = ROOT
                    province = ROOT
                    home = ROOT
                    troops = {
                        light_infantry = { 500 500 }
                    }
                    attrition = 1.0
                    disband_on_peace = yes
                    maintenance_multiplier = 0
                }
            }
        }

        # Apprentice
        if = {
            limit = { trait = ml_trait_arcane_spell_apprentice }

            # Earth mages will summon extra golem troops!
            if = {
                limit = { has_character_flag = ml_flag_earth_mage }
                spawn_unit = {
                    owner = ROOT
                    province = ROOT
                    home = ROOT
                    troops = {
                        light_infantry = { 1000 1000 }
                        heavy_infantry = { 1000 1000 }
                    }
                    attrition = 1.0
                    disband_on_peace = yes
                    maintenance_multiplier = 0
                }
            }

            if = {
                limit = { NOT = { has_character_flag = ml_flag_earth_mage } }
                spawn_unit = {
                    owner = ROOT
                    province = ROOT
                    home = ROOT
                    troops = {
                        light_infantry = { 1000 1000 }
                    }
                    attrition = 1.0
                    disband_on_peace = yes
                    maintenance_multiplier = 0
                }
            }
        }

        # Expert
        if = {
            limit = { trait = ml_trait_arcane_spell_expert }

            # Earth mages will summon extra golem troops!
            if = {
                limit = { has_character_flag = ml_flag_earth_mage }
                spawn_unit = {
                    owner = ROOT
                    province = ROOT
                    home = ROOT
                    troops = {
                        light_infantry = { 1000 1000 }
                        heavy_infantry = { 1500 1500 }
                    }
                    attrition = 1.0
                    disband_on_peace = yes
                    maintenance_multiplier = 0
                }
            }

            if = {
                limit = { NOT = { has_character_flag = ml_flag_earth_mage } }
                spawn_unit = {
                    owner = ROOT
                    province = ROOT
                    home = ROOT
                    troops = {
                        light_infantry = { 1000 1000 }
                        heavy_infantry = { 500 500 }
                    }
                    attrition = 1.0
                    disband_on_peace = yes
                    maintenance_multiplier = 0
                }
            }
        }

        # Master
        if = {
            limit = { trait = ml_trait_arcane_spell_master }

            # Earth mages will summon extra golem troops!
            if = {
                limit = { has_character_flag = ml_flag_earth_mage }
                spawn_unit = {
                    owner = ROOT
                    province = ROOT
                    home = ROOT
                    troops = {
                        light_infantry = { 1000 1000 }
                        heavy_infantry = { 2000 2000 }
                        light_cavalry  = { 500 500 }
                    }
                    attrition = 1.0
                    disband_on_peace = yes
                    maintenance_multiplier = 0
                }
            }

            if = {
                limit = { NOT = { has_character_flag = ml_flag_earth_mage } }
                spawn_unit = {
                    owner = ROOT
                    province = ROOT
                    home = ROOT
                    troops = {
                        light_infantry = { 1000 1000 }
                        heavy_infantry = { 1000 1000 }
                        light_cavalry  = { 500 500 }
                    }
                    attrition = 1.0
                    disband_on_peace = yes
                    maintenance_multiplier = 0
                }
            }
        }

        set_character_flag = ml_flag_recent_summon_spell
    }

    # Default option
    option = {
        name = ml_events_common.ok

        # Spell cooldown
        character_event = {
            id = "ml_events_spells.10"
            days = 1460
        }
    }
}

# Clear summoning spell cooldown
character_event = {
    id = "ml_events_spells.10"

    hide_window = yes

    is_triggered_only = yes

    trigger = {
        has_character_flag = ml_flag_recent_summon_spell
    }

    immediate = {
        clr_character_flag = ml_flag_recent_summon_spell
    }

    # Default option
    option = {
        name = ml_events_common.ok
    }
}

# Clear air mage sickness spell cooldown
character_event = {
    id = "ml_events_spells.12"

    hide_window = yes

    is_triggered_only = yes

    trigger = {
        has_character_flag = ml_flag_recent_cast_sickness
    }

    immediate = {
        clr_character_flag = ml_flag_recent_cast_sickness
    }

    # Default option
    option = {
        name = ml_events_common.ok
    }
}

# Clear water mage illusion charm spell cooldown
character_event = {
    id = "ml_events_spells.13"

    hide_window = yes

    is_triggered_only = yes

    trigger = {
        has_character_flag = ml_flag_recent_cast_illusion
    }

    immediate = {
        clr_character_flag = ml_flag_recent_cast_illusion
    }

    # Default option
    option = {
        name = ml_events_common.ok
    }
}

# Clear air mage magically cursed spell
character_event = {
    id = "ml_events_spells.14"

    hide_window = yes

    is_triggered_only = yes

    trigger = {
        has_character_flag = ml_flag_recent_cast_magical_curse
    }

    immediate = {
        clr_character_flag = ml_flag_recent_cast_magical_curse
    }

    # Default option
    option = {
        name = ml_events_common.ok
    }
}

# Magically protected someone.
character_event = {
    id = "ml_events_spells.15"
    hide_window = yes
    is_triggered_only = yes

    trigger = {
        NOR = { 
            trait = ml_trait_magical_protection_1
            trait = ml_trait_magical_protection_2
            trait = ml_trait_magical_protection_3
            trait = ml_trait_magical_protection_4 
        }
    }

    immediate = {
        # if = {
        #     limit = {
        #         FROM = {
        #             trait = ml_trait_arcane_spell_beginner
        #         } 
        #     }
        #     add_character_modifier = {
        #         name = ml_event_modifiers_spells_protection_ward_1
        #     }
        #     add_trait = ml_trait_magical_protection_1
        # }
        # if = {
        #     limit = {
        #         FROM = {
        #             trait = ml_trait_arcane_spell_apprentice
        #         } 
        #     }
        #     add_character_modifier = {
        #         name = ml_event_modifiers_spells_protection_ward_2
        #     }
        #     add_trait = ml_trait_magical_protection_2
        # }
        # if = {
        #     limit = {
        #         FROM = {
        #             trait = ml_trait_arcane_spell_expert
        #         } 
        #     }
        #     add_character_modifier = {
        #         name = ml_event_modifiers_spells_protection_ward_3
        #     }
        #     add_trait = ml_trait_magical_protection_3
        # }
        # if = {
            # limit = {
            #     FROM = {
            #         trait = ml_trait_arcane_spell_master
            #     } 
            # }
            add_character_modifier = {
                modifier = ml_event_modifiers_spells_protection_ward_4
                duration = -1
            }
            add_trait = ml_trait_magical_protection_4
        # }
    }

    # Default option
    option = {
        name = ml_events_common.ok
    }
}
# Revoke magical protection.
character_event = {
    id = "ml_events_spells.16"
    hide_window = yes
    is_triggered_only = yes

    trigger = {
        OR = {
            trait = ml_trait_magical_protection_1
            trait = ml_trait_magical_protection_2
            trait = ml_trait_magical_protection_3
            trait = ml_trait_magical_protection_4
        }
    }

    immediate = {
        # if = {
        #     limit = { has_character_modifier = ml_event_modifiers_spells_protection_ward_1 }
        #     remove_character_modifier = ml_event_modifiers_spells_protection_ward_1
        #     remove_trait = ml_trait_magical_protection_1
        # }
        # if = {
        #     limit = { has_character_modifier = ml_event_modifiers_spells_protection_ward_2 }
        #     remove_character_modifier = ml_event_modifiers_spells_protection_ward_2
        #     remove_trait = ml_trait_magical_protection_2
        # }
        # if = {
        #     limit = { has_character_modifier = ml_event_modifiers_spells_protection_ward_3 }
        #     remove_character_modifier = ml_event_modifiers_spells_protection_ward_3
        #     remove_trait = ml_trait_magical_protection_3
        # }
        # if = {
            # limit = { has_character_modifier = ml_event_modifiers_spells_protection_ward_4 }
            remove_character_modifier = ml_event_modifiers_spells_protection_ward_4
            remove_trait = ml_trait_magical_protection_4
        # }
    }

    # Default option
    option = {
        name = ml_events_common.ok
    }
}

# Deactivate active spells
character_event = {
    id = "ml_events_spells.0"

    hide_window = yes

    is_triggered_only = yes

    trigger = {
        trait = ml_trait_magical_blood
    }

    immediate = {
        # Remove all modifiers

        # Buff Spell
        if = {
            limit = { has_character_modifier = ml_event_modifiers_spells_buff_1 }
            remove_character_modifier = ml_event_modifiers_spells_buff_1
        }

        if = {
            limit = { has_character_modifier = ml_event_modifiers_spells_buff_2 }
            remove_character_modifier = ml_event_modifiers_spells_buff_2
        }

        if = {
            limit = { has_character_modifier = ml_event_modifiers_spells_buff_3 }
            remove_character_modifier = ml_event_modifiers_spells_buff_3
        }

        if = {
            limit = { has_character_modifier = ml_event_modifiers_spells_buff_4 }
            remove_character_modifier = ml_event_modifiers_spells_buff_4
        }

        # Propser Spell
        if = {
            limit = { has_character_modifier = ml_event_modifiers_spells_prosper_1 }
            remove_character_modifier = ml_event_modifiers_spells_prosper_1
        }

        if = {
            limit = { has_character_modifier = ml_event_modifiers_spells_prosper_2 }
            remove_character_modifier = ml_event_modifiers_spells_prosper_2
        }

        if = {
            limit = { has_character_modifier = ml_event_modifiers_spells_prosper_3 }
            remove_character_modifier = ml_event_modifiers_spells_prosper_3
        }

        if = {
            limit = { has_character_modifier = ml_event_modifiers_spells_prosper_4 }
            remove_character_modifier = ml_event_modifiers_spells_prosper_4
        }

        # Clear active flag.
        clr_character_flag = ml_flag_has_active_spell

        # Clear active spell flags.
        clr_character_flag = ml_flag_active_buff_spell
        clr_character_flag = ml_flag_active_prosper_spell
        clr_character_flag = ml_flag_active_plague_spell
        clr_character_flag = ml_flag_active_lifechange_spell

        # Remove buff traits.
        remove_trait = ml_trait_buff_spell_1
        remove_trait = ml_trait_buff_spell_2
        remove_trait = ml_trait_buff_spell_3
        remove_trait = ml_trait_buff_spell_4

        # Some bug with the health spell clearing...
        clr_character_flag = ml_flag_recent_healing_spell
    }

    # Default option
    option = {
        name = ml_events_common.ok
    }
}
